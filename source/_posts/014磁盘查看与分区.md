---
title: 014磁盘查看与分区
date: 2017-07-28
tags:
- tech
- Linux
---

df命令
du命令
磁盘分区

<!--more-->

## df命令
`df`输出磁盘文件系统使用情况:
```
[root@centos ~]# df
文件系统          1K-块    已用    可用 已用% 挂载点
/dev/sda3      11208704 7214792 3993912   65% /
devtmpfs         496920       0  496920    0% /dev
tmpfs            507752       0  507752    0% /dev/shm
tmpfs            507752    6852  500900    2% /run
tmpfs            507752       0  507752    0% /sys/fs/cgroup
/dev/sda1        201380  103660   97720   52% /boot
tmpfs            101552       0  101552    0% /run/user/0
```
主要关注已用百分比、挂载点。有tmpfs字样的是临时文件系统，系统断电后数据不保存，/dev/sda是咱们的磁盘。

有几个常用参数，-h以适当单位显示，默认“已用”一列是KB。-m则是以MB为单位显示磁盘使用量。-i 显示inode使用情况。磁盘格式化时产生inode和block，有点想在一张纸上画格子，可以存内容格子是block，inode是指向block的目录索引。linux可能会遇到inode使用完而block还有剩余，但这时系统不能往磁盘写入文件。

计算机存储介质单位主要有Byte、KB、MB、GB、TB。以上是按从小到大顺序排列的，换算进制是1024。还有更小的单位是bit，代表0或1,可以说传递一个信息量。8bit=1Byte，这个换算进制不是1024。在网络传输速度上我们常用Mbpm（b是bit，pm是每秒）。从这个单位可以得到启发：
- 可以理解为计算机通过网线传输一串01代表的信息
- 买的100M宽带，最高下载写入磁盘的速度是100Mbit/s=1.25MB/s

此外，在安装linux时磁盘还划分了swap空间，df命令查看不到。查看swap空间使用`free`。

## du命令
`du -sh file`可以查看一个文件或目录的磁盘占用情况。-s显示总用量，如果查看目录时不加-s则显示目录下各个文件的情况。-h以合适单位显示大小。

文件大小还可以在`ls -l`中看到。但是与du命令不同，ls显示的是实际文件大小，du显示的是占用磁盘大小。其实挺好理解，前面说磁盘格式化就像在白纸上画格子，那么每个格子（block）就会有一定大小来存储内容。一个格子（block）不能放多个文件的内容，不然会造成混乱。也就是说文件即使占用半个block大小，这个block不再被别的文件使用。du就是从block大小来衡量文件大小的，而ls是从文件存放bit信息量来衡量。当然du也可以查看文件内容大小，需要使用参数-sb。

## 磁盘分区
### fdisk工具
`fdisk -l`查看系统当下挂载磁盘情况。fdisk还是分区工具，`fdisk /dev/sdb`为sdb磁盘分区。新磁盘投入使用一般先分区再格式化，也可以直接格式化。

fdisk格式化分区命令输入终端，输入m获得帮助，会列出详细引导。其中常用的有：n新建分区，w保存设置，d删除分区。我们在虚拟机中试验添加磁盘，可能需要重启虚拟机才能识别新建的磁盘。现实服务器上大多支持热拔插磁盘。

使用fdisk分区最多设置4个主分区（primary）。如果有更多分区需求，设置3个主分区（primary）+1个扩展分区（extended）。扩展分区里可以设置多个逻辑分区。总之primary+extended<5。扩展分区相当于是壳子，要使用磁盘还要在里面划出逻辑分区。

有一个特点：逻辑分区号从5开始，且分区号是连续的。主分区分区号可以不连续。

设定好磁盘分区注意保存再退出，不然划分会丢失。

### gdisk工具

### parted工具

### 三种工具比较
- fdisk只能用于MBR分区，gdisk,parted可以用于GPT分区。
- fdisk大多数运维工作人员已经习惯这个交互模式。
- parted命令在创建删除分区使用命令比较方便，但是功能不是太完善，没有备份还原命令。
- gdisk在分区上命令和fdisk风格一样， 使用方便，学习难度低且功能强大，推荐使用。

